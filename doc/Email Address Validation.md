# Валидация почтовых адресов
В общем случае почтовый адрес описывается следующим образом:
```
local-part "@" domain
```
Адрес электронной почты является нечувствительным к регистру, то есть адреса postmaster@domain.com и PoStMaStEr@DoMaIn.CoM являются идентичными для протоколов, связанных с электронной почтой и доменными именами. Нужно разделить валидацию по длине частей адреса электронной почты и по допустимым символам.

## Валидация по длине
### Длина имени пользователя (local-part)
Имя пользователя (до @) не может превышать 63 байта
### Длина имени сервера (domain)
Полное доменное имя (FQDN- fully qualified domain name) может состоять из нескольких частей, разделенных точками, и состоит из последовательности всех родительских доменных имен в иерархии DNS.

FQDN в адресе электронной почты не может превышать 255 байт. При этом длина доменного имени каждого уровня не должна превышать 63 байта, а диапазон длины доменного имени второго уровня в зоне .ru ограничен длиной от 2 до 63 байт. 

**Пример**

В случае адреса электронной почты 
```
user.name+tag@mail.domainnameof63letters.com
```
Длина строки "user.name+tag" должна быть менее 63 байт, а строка "mail.domainnameof63letters.com" должна быть короче 255 байт. 

## Валидация по допустимым символам
### Допустимые символы для имен пользователей (local-part)
В имени пользователя допустимы латинские буквы и цифры, символы ".", "\_", "-", а также могут быть использованы специальные символы (!#$%&'*+-/=?^\_`{}|~). Также некоторые почтовые сервера могут поддерживать юникодные символы, однако, это не получило широкого распространения.

 :bulb: В общем случае, наверное, не стоит проверять юникод

### Допустимые символы для адреса сервера (domain)

* Почтовый сервер может выглядеть как IP-адрес 4-й либо 6-й версии, заключенный в квадратные скобки, где для 6-й версии проставляется отдельная маркировка:
```
postmaster@[123.123.123.123]
postmaster@[IPv6:2001:0db8:85a3:0000:0000:8a2e:0370:7334]
```
* Доменное имя не должно начинаться или заканчиваться дефисом. Также запрещено использование двух и более дефисов подряд;  
* Доменные имена, описанные стандартом доменных имен могут содержать только 26 букв латинского алфавита, цифры и знак дефиса;
* Юникодные доменные имена, такие как 080-САНКТ-ПЕТЕРБУРГ.рф могут содержать в каждом уровне такое количество символов, чтобы представление обозначения в кодировке Punycode содержало не более 63 символов.
  
## Критерии валидации адреса электронной почты

:bulb: В общем случае при регистрации пользователя мы будем отправлять ему письмо со ссылкой, которую он должен будет открыть, чтобы подтвердить почтовый адрес.  Чтобы не усложнять работу и не пытаться создать идеальное регулярное выражение, следует проверять следующие критерии соответствия:

* Длины обеих частей адреса
* Домен минимум первого уровня (хотя, наверное, лучше проверять минимум второй)
* Содержит единственную @
* Доменное имя не начинается, не заканчивается дефисом и не содержит два и более дефиса подряд. 
* Доменное имя состоит только из стандартных символов, а именно латинских букв любого регистра, цифр и дефисов
* Будем предполагать, что пользователей, развернувших свой почтовй сервер без доменного имени на одном только IP, у нас не будет, и такие адреса будем считать невалидными. 

Остальные проверки видятся избыточными.

## Регулярное выражение

Будет добавлено после полного тестирования

## Официальные стандарты и справочные материалы
* [RFC5322](https://datatracker.ietf.org/doc/html/rfc5322) официальный стандарт почтовых адресов, заголовков и тел сообщений;
* [RFC1035](https://datatracker.ietf.org/doc/html/rfc1035) официальный стандарт доменных имен;
* [Punycode](https://ru.wikipedia.org/wiki/Punycode) Описание стандарта кодирования, используемого в так называемых юникодных (Unicode) доменных именах, например, 080-САНКТ-ПЕТЕРБУРГ.рф;
* [Примеры валидных почтовых адресов](https://en.wikipedia.org/wiki/Email_address#Valid_email_addresses)
* [Стандарт (RFC3492)](https://datatracker.ietf.org/doc/html/rfc3492) для представления юникодных (на национальных языках) доменных имен в формате ASCII-compatible encoding
